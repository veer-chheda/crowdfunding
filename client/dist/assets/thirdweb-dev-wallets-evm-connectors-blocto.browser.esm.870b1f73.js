import{cZ as He,i as Xe,b as Fe,w as $t,e as we,f as ue,a4 as zt,n as ge,h as k,aE as Yt,af as Vt}from"./index.293c77a4.js";import{g as Jt}from"./url-bc88b2b6.browser.esm.94115fe4.js";import{W as Wt,U as Ze,a as Gt,S as Ne}from"./errors-d961f852.browser.esm.61f33de0.js";import{n as Qe}from"./normalizeChainId-e4cc0175.browser.esm.042707b7.js";function w(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(h){try{d(n.next(h))}catch(l){s(l)}}function c(h){try{d(n.throw(h))}catch(l){s(l)}}function d(h){h.done?o(h.value):i(h.value).then(a,c)}d((n=n.apply(r,e||[])).next())})}function N(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function ae(r,e){if(!r)throw new Error(e)}var M;(function(r){r.prod="BLOCTO_SDK",r.dev="BLOCTO_SDK_DEV",r.staging="BLOCTO_SDK_STAGING"})(M||(M={}));var b;(function(r){r.ETHEREUM="ethereum",r.SOLANA="solana",r.APTOS="aptos"})(b||(b={}));class Ht{constructor(){this.storage={}}getItem(e){return this[e]||null}setItem(e,t){this.storage[e]=t}removeItem(e){delete this.storage[e]}}const Xt=typeof window<"u"?window.memoryStorage:new Ht,Zt=()=>{if(typeof window>"u")return!1;try{window.sessionStorage.setItem("local_storage_supported","1");const r=window.sessionStorage.getItem("local_storage_supported");return window.sessionStorage.removeItem("local_storage_supported"),r==="1"}catch{return!1}},Le=Zt()?window.sessionStorage:Xt,ft=(r,e=null)=>{const t=Le.getItem(r);try{return t&&JSON.parse(t)||e}catch{return t||e}},pt=(r,e)=>Le.setItem(r,typeof e=="string"?e:JSON.stringify(e)),qe=r=>{pt(r,""),Le.removeItem(r)},q=r=>{const e=ft(r,null);return e?new Date().getTime()>e.expiry||e.v!==ve?(qe(r),null):e==null?void 0:e.data:null},pe=(r,e,t)=>{var n,i,o;const s=ft(r),a={data:{code:(e==null?void 0:e.code)||((n=s==null?void 0:s.data)===null||n===void 0?void 0:n.code),connected:!!((e==null?void 0:e.code)||((i=s==null?void 0:s.data)===null||i===void 0?void 0:i.code)),accounts:Object.assign(Object.assign({},(o=s==null?void 0:s.data)===null||o===void 0?void 0:o.accounts),e==null?void 0:e.accounts)},expiry:t||(s==null?void 0:s.expiry)||new Date().getTime()+ar,v:ve};pt(r,a)},R=(r,e)=>{var t,n;return!((t=q(r))===null||t===void 0)&&t.code?((n=q(r))===null||n===void 0?void 0:n.accounts[e])||null:(qe(r),null)},he=(r,e,t)=>{pe(r,{accounts:{[e]:t}})},$e=(r,e)=>{pe(r,{accounts:{[e]:void 0}})},Qt={56:"https://bsc-dataseed1.binance.org",97:"https://data-seed-prebsc-1-s1.binance.org:8545",137:"https://rpc-mainnet.maticvigil.com/",80001:"https://rpc-mumbai.matic.today/",43114:"https://api.avax.network/ext/bc/C/rpc",43113:"https://api.avax-test.network/ext/bc/C/rpc",42161:"https://arb1.arbitrum.io/rpc",421613:"https://endpoints.omniatech.io/v1/arbitrum/goerli/public",10:"https://mainnet.optimism.io",420:"https://goerli.optimism.io"},et={prod:"https://wallet-v2.blocto.app",staging:"https://wallet-v2-staging.blocto.app",dev:"https://wallet-v2-dev.blocto.app"},er={prod:M.prod,staging:M.staging,dev:M.dev},ee={MainnetBeta:"mainnet-beta",Testnet:"testnet",Devnet:"devnet"},tr={[ee.MainnetBeta]:"https://wallet-v2.blocto.app",[ee.Devnet]:"https://wallet-v2-dev.blocto.app",[ee.Testnet]:"https://wallet-v2-dev.blocto.app"},rr={[ee.MainnetBeta]:M.prod,[ee.Devnet]:M.dev,[ee.Testnet]:M.dev},nr={1:M.prod,2:M.dev,3:M.dev,4:M.dev,5:M.staging},ir={1:"https://wallet-v2.blocto.app",2:"https://wallet-v2-dev.blocto.app",3:"https://wallet-v2-dev.blocto.app",4:"https://wallet-v2-dev.blocto.app",5:"https://wallet-v2-staging.blocto.app"};var X;(function(r){r.Mainnet="mainnet",r.Testnet="testnet",r.Devnet="devnet",r.Testing="testing",r.Premainnet="premainnet"})(X||(X={}));const or={1:X.Mainnet,2:X.Testnet,3:X.Devnet,4:X.Testing,5:X.Premainnet},sr={1:"https://fullnode.mainnet.aptoslabs.com/v1",2:"https://fullnode.testnet.aptoslabs.com/v1",3:"https://fullnode.devnet.aptoslabs.com/v1",4:"",5:"https://premainnet.aptosdev.com/v1"},tt=["connect","disconnect","message","chainChanged","accountsChanged"],ar=86400*1e3,Pe="00000000-0000-0000-0000-000000000000",ve="0.5.5";class ze{constructor(){this.isBlocto=!0,this.isConnecting=!1,this.eventListeners={},this.off=this.removeListener,tt.forEach(e=>{this.eventListeners[e]=[]}),this.appId=Pe}request(e){return w(this,void 0,void 0,function*(){})}on(e,t){!tt.includes(e)||this.eventListeners[e].push(t)}once(){}removeListener(e,t){const i=this.eventListeners[e].findIndex(o=>o===t);i!==-1&&this.eventListeners[e].splice(i,1)}}const cr="width:100vw;height:100%;position:fixed;top:0;left:0;z-index:2147483646;border:none;box-sizing:border-box;color-scheme:light;inset:0px;display:block;pointer-events:auto;";function ie(r){const e=document.createElement("iframe");return e.setAttribute("src",r),e.setAttribute("style",cr),e}function oe(r){document.body.appendChild(r)}function B(r){const e=r&&r.parentNode;e&&e.removeChild instanceof Function&&e.removeChild(r)}var te=(r,e,t=window)=>{function n(i){e(i,()=>t.removeEventListener(r,n))}t.addEventListener(r,n)};function re(r,e,t){return w(this,void 0,void 0,function*(){if((r.status===403||r.status===401)&&(t&&t(),qe(e)),!r.ok){const n=yield r.json(),i=new Error((n==null?void 0:n.message)||"unknown error");throw i.error_code=n==null?void 0:n.error_code,i}return r.json()})}const rt=r=>/\S+@\S+\.\S+/.test(r),vt=r=>typeof r=="object"&&r!==null&&"from"in r,ur=r=>Array.isArray(r)&&r.every(e=>vt(e));function hr(){return w(this,void 0,void 0,function*(){const{networks:r}=yield fetch("https://api.blocto.app/networks/evm").then(t=>t.json());return r.reduce((t,n)=>Object.assign(Object.assign({},t),{[n.chain_id]:n}),{})})}function dr(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var E={};function mt(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function U(r){return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(r)}function lr(r,e){if(U(r)!=="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(U(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function fr(r){var e=lr(r,"string");return U(e)==="symbol"?e:String(e)}function nt(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,fr(n.key),n)}}function wt(r,e,t){return e&&nt(r.prototype,e),t&&nt(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function de(r,e){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},de(r,e)}function gt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&de(r,e)}function pr(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function vr(r,e){if(e&&(U(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pr(r)}function le(r){return le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},le(r)}function mr(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function wr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Se(r,e,t){return wr()?Se=Reflect.construct.bind():Se=function(i,o,s){var a=[null];a.push.apply(a,o);var c=Function.bind.apply(i,a),d=new c;return s&&de(d,s.prototype),d},Se.apply(null,arguments)}function Ue(r){var e=typeof Map=="function"?new Map:void 0;return Ue=function(n){if(n===null||!mr(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(n))return e.get(n);e.set(n,i)}function i(){return Se(n,arguments,le(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),de(i,n)},Ue(r)}var J={},gr=fe;fe.default=fe;fe.stable=_t;fe.stableStringify=_t;var be="[...]",yt="[Circular]",ne=[],Z=[];function Et(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function fe(r,e,t,n){typeof n>"u"&&(n=Et()),je(r,"",0,[],void 0,0,n);var i;try{Z.length===0?i=JSON.stringify(r,e,t):i=JSON.stringify(r,St(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ne.length!==0;){var o=ne.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function se(r,e,t,n){var i=Object.getOwnPropertyDescriptor(n,t);i.get!==void 0?i.configurable?(Object.defineProperty(n,t,{value:r}),ne.push([n,t,e,i])):Z.push([e,t,r]):(n[t]=r,ne.push([n,t,e]))}function je(r,e,t,n,i,o,s){o+=1;var a;if(U(r)==="object"&&r!==null){for(a=0;a<n.length;a++)if(n[a]===r){se(yt,r,e,i);return}if(typeof s.depthLimit<"u"&&o>s.depthLimit){se(be,r,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){se(be,r,e,i);return}if(n.push(r),Array.isArray(r))for(a=0;a<r.length;a++)je(r[a],a,a,n,r,o,s);else{var c=Object.keys(r);for(a=0;a<c.length;a++){var d=c[a];je(r[d],d,a,n,r,o,s)}}n.pop()}}function yr(r,e){return r<e?-1:r>e?1:0}function _t(r,e,t,n){typeof n>"u"&&(n=Et());var i=Ke(r,"",0,[],void 0,0,n)||r,o;try{Z.length===0?o=JSON.stringify(i,e,t):o=JSON.stringify(i,St(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ne.length!==0;){var s=ne.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return o}function Ke(r,e,t,n,i,o,s){o+=1;var a;if(U(r)==="object"&&r!==null){for(a=0;a<n.length;a++)if(n[a]===r){se(yt,r,e,i);return}try{if(typeof r.toJSON=="function")return}catch{return}if(typeof s.depthLimit<"u"&&o>s.depthLimit){se(be,r,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){se(be,r,e,i);return}if(n.push(r),Array.isArray(r))for(a=0;a<r.length;a++)Ke(r[a],a,a,n,r,o,s);else{var c={},d=Object.keys(r).sort(yr);for(a=0;a<d.length;a++){var h=d[a];Ke(r[h],h,a,n,r,o,s),c[h]=r[h]}if(typeof i<"u")ne.push([i,e,r]),i[e]=c;else return c}n.pop()}}function St(r){return r=typeof r<"u"?r:function(e,t){return t},function(e,t){if(Z.length>0)for(var n=0;n<Z.length;n++){var i=Z[n];if(i[1]===e&&i[0]===t){t=i[2],Z.splice(n,1);break}}return r.call(this,e,t)}}function bt(r){var e=Er();return function(){var n=le(r),i;if(e){var o=le(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return vr(this,i)}}function Er(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}Object.defineProperty(J,"__esModule",{value:!0});J.EthereumProviderError=J.EthereumRpcError=void 0;var _r=gr,At=function(r){gt(t,r);var e=bt(t);function t(n,i,o){var s;if(mt(this,t),!Number.isInteger(n))throw new Error('"code" must be an integer.');if(!i||typeof i!="string")throw new Error('"message" must be a nonempty string.');return s=e.call(this,i),s.code=n,o!==void 0&&(s.data=o),s}return wt(t,[{key:"serialize",value:function(){var i={code:this.code,message:this.message};return this.data!==void 0&&(i.data=this.data),this.stack&&(i.stack=this.stack),i}},{key:"toString",value:function(){return _r.default(this.serialize(),Ar,2)}}]),t}(Ue(Error));J.EthereumRpcError=At;var Sr=function(r){gt(t,r);var e=bt(t);function t(n,i,o){if(mt(this,t),!br(n))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');return e.call(this,n,i,o)}return wt(t)}(At);J.EthereumProviderError=Sr;function br(r){return Number.isInteger(r)&&r>=1e3&&r<=4999}function Ar(r,e){if(e!=="[Circular]")return e}var Ye={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.errorValues=W.errorCodes=void 0;W.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};W.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.serializeError=r.isValidCode=r.getMessageFromCode=r.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;var e=W,t=J,n=e.errorCodes.rpc.internal,i="Unspecified error message. This is a bug, please report it.",o={code:n,message:s(n)};r.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function s(p){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;if(Number.isInteger(p)){var v=p.toString();if(l(e.errorValues,v))return e.errorValues[v].message;if(d(p))return r.JSON_RPC_SERVER_ERROR_MESSAGE}return f}r.getMessageFromCode=s;function a(p){if(!Number.isInteger(p))return!1;var f=p.toString();return!!(e.errorValues[f]||d(p))}r.isValidCode=a;function c(p){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=f.fallbackError,g=v===void 0?o:v,m=f.shouldIncludeStack,y=m===void 0?!1:m,S,I;if(!g||!Number.isInteger(g.code)||typeof g.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(p instanceof t.EthereumRpcError)return p.serialize();var _={};if(p&&U(p)==="object"&&!Array.isArray(p)&&l(p,"code")&&a(p.code)){var A=p;_.code=A.code,A.message&&typeof A.message=="string"?(_.message=A.message,l(A,"data")&&(_.data=A.data)):(_.message=s(_.code),_.data={originalError:h(p)})}else{_.code=g.code;var P=(S=p)===null||S===void 0?void 0:S.message;_.message=P&&typeof P=="string"?P:g.message,_.data={originalError:h(p)}}var O=(I=p)===null||I===void 0?void 0:I.stack;return y&&p&&O&&typeof O=="string"&&(_.stack=O),_}r.serializeError=c;function d(p){return p>=-32099&&p<=-32e3}function h(p){return p&&U(p)==="object"&&!Array.isArray(p)?Object.assign({},p):p}function l(p,f){return Object.prototype.hasOwnProperty.call(p,f)}})(Ye);function Ir(r){if(Array.isArray(r))return r}function Pr(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,o,s,a=[],c=!0,d=!1;try{if(o=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=o.call(t)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(h){d=!0,i=h}finally{try{if(!c&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return a}}function it(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Rr(r,e){if(!!r){if(typeof r=="string")return it(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return it(r,e)}}function xr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function It(r,e){return Ir(r)||Pr(r,e)||Rr(r,e)||xr()}var Re={};Object.defineProperty(Re,"__esModule",{value:!0});Re.ethErrors=void 0;var Ve=J,Pt=Ye,F=W;Re.ethErrors={rpc:{parse:function(e){return j(F.errorCodes.rpc.parse,e)},invalidRequest:function(e){return j(F.errorCodes.rpc.invalidRequest,e)},invalidParams:function(e){return j(F.errorCodes.rpc.invalidParams,e)},methodNotFound:function(e){return j(F.errorCodes.rpc.methodNotFound,e)},internal:function(e){return j(F.errorCodes.rpc.internal,e)},server:function(e){if(!e||U(e)!=="object"||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");var t=e.code;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return j(t,e)},invalidInput:function(e){return j(F.errorCodes.rpc.invalidInput,e)},resourceNotFound:function(e){return j(F.errorCodes.rpc.resourceNotFound,e)},resourceUnavailable:function(e){return j(F.errorCodes.rpc.resourceUnavailable,e)},transactionRejected:function(e){return j(F.errorCodes.rpc.transactionRejected,e)},methodNotSupported:function(e){return j(F.errorCodes.rpc.methodNotSupported,e)},limitExceeded:function(e){return j(F.errorCodes.rpc.limitExceeded,e)}},provider:{userRejectedRequest:function(e){return ce(F.errorCodes.provider.userRejectedRequest,e)},unauthorized:function(e){return ce(F.errorCodes.provider.unauthorized,e)},unsupportedMethod:function(e){return ce(F.errorCodes.provider.unsupportedMethod,e)},disconnected:function(e){return ce(F.errorCodes.provider.disconnected,e)},chainDisconnected:function(e){return ce(F.errorCodes.provider.chainDisconnected,e)},custom:function(e){if(!e||U(e)!=="object"||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");var t=e.code,n=e.message,i=e.data;if(!n||typeof n!="string")throw new Error('"message" must be a nonempty string');return new Ve.EthereumProviderError(t,n,i)}}};function j(r,e){var t=Rt(e),n=It(t,2),i=n[0],o=n[1];return new Ve.EthereumRpcError(r,i||Pt.getMessageFromCode(r),o)}function ce(r,e){var t=Rt(e),n=It(t,2),i=n[0],o=n[1];return new Ve.EthereumProviderError(r,i||Pt.getMessageFromCode(r),o)}function Rt(r){if(r){if(typeof r=="string")return[r];if(U(r)==="object"&&!Array.isArray(r)){var e=r.message,t=r.data;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,t]}}return[]}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.getMessageFromCode=r.serializeError=r.EthereumProviderError=r.EthereumRpcError=r.ethErrors=r.errorCodes=void 0;var e=J;Object.defineProperty(r,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(r,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});var t=Ye;Object.defineProperty(r,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(r,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});var n=Re;Object.defineProperty(r,"ethErrors",{enumerable:!0,get:function(){return n.ethErrors}});var i=W;Object.defineProperty(r,"errorCodes",{enumerable:!0,get:function(){return i.errorCodes}})})(E);var ot=typeof He<"u"?He:typeof self<"u"?self:typeof window<"u"?window:{},L=[],K=[],Tr=typeof Uint8Array<"u"?Uint8Array:Array,Je=!1;function xt(){Je=!0;for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,t=r.length;e<t;++e)L[e]=r[e],K[r.charCodeAt(e)]=e;K["-".charCodeAt(0)]=62,K["_".charCodeAt(0)]=63}function Or(r){Je||xt();var e,t,n,i,o,s,a=r.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=r[a-2]==="="?2:r[a-1]==="="?1:0,s=new Tr(a*3/4-o),n=o>0?a-4:a;var c=0;for(e=0,t=0;e<n;e+=4,t+=3)i=K[r.charCodeAt(e)]<<18|K[r.charCodeAt(e+1)]<<12|K[r.charCodeAt(e+2)]<<6|K[r.charCodeAt(e+3)],s[c++]=i>>16&255,s[c++]=i>>8&255,s[c++]=i&255;return o===2?(i=K[r.charCodeAt(e)]<<2|K[r.charCodeAt(e+1)]>>4,s[c++]=i&255):o===1&&(i=K[r.charCodeAt(e)]<<10|K[r.charCodeAt(e+1)]<<4|K[r.charCodeAt(e+2)]>>2,s[c++]=i>>8&255,s[c++]=i&255),s}function Cr(r){return L[r>>18&63]+L[r>>12&63]+L[r>>6&63]+L[r&63]}function Fr(r,e,t){for(var n,i=[],o=e;o<t;o+=3)n=(r[o]<<16)+(r[o+1]<<8)+r[o+2],i.push(Cr(n));return i.join("")}function st(r){Je||xt();for(var e,t=r.length,n=t%3,i="",o=[],s=16383,a=0,c=t-n;a<c;a+=s)o.push(Fr(r,a,a+s>c?c:a+s));return n===1?(e=r[t-1],i+=L[e>>2],i+=L[e<<4&63],i+="=="):n===2&&(e=(r[t-2]<<8)+r[t-1],i+=L[e>>10],i+=L[e>>4&63],i+=L[e<<2&63],i+="="),o.push(i),o.join("")}function xe(r,e,t,n,i){var o,s,a=i*8-n-1,c=(1<<a)-1,d=c>>1,h=-7,l=t?i-1:0,p=t?-1:1,f=r[e+l];for(l+=p,o=f&(1<<-h)-1,f>>=-h,h+=a;h>0;o=o*256+r[e+l],l+=p,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;h>0;s=s*256+r[e+l],l+=p,h-=8);if(o===0)o=1-d;else{if(o===c)return s?NaN:(f?-1:1)*(1/0);s=s+Math.pow(2,n),o=o-d}return(f?-1:1)*s*Math.pow(2,o-n)}function Tt(r,e,t,n,i,o){var s,a,c,d=o*8-i-1,h=(1<<d)-1,l=h>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,v=n?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),s+l>=1?e+=p/c:e+=p*Math.pow(2,1-l),e*c>=2&&(s++,c/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(e*c-1)*Math.pow(2,i),s=s+l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;r[t+f]=a&255,f+=v,a/=256,i-=8);for(s=s<<i|a,d+=i;d>0;r[t+f]=s&255,f+=v,s/=256,d-=8);r[t+f-v]|=g*128}var Nr={}.toString,Ot=Array.isArray||function(r){return Nr.call(r)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var Br=50;u.TYPED_ARRAY_SUPPORT=ot.TYPED_ARRAY_SUPPORT!==void 0?ot.TYPED_ARRAY_SUPPORT:!0;Ae();function Ae(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Y(r,e){if(Ae()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(r=new Uint8Array(e),r.__proto__=u.prototype):(r===null&&(r=new u(e)),r.length=e),r}function u(r,e,t){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(r,e,t);if(typeof r=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return We(this,r)}return Ct(this,r,e,t)}u.poolSize=8192;u._augment=function(r){return r.__proto__=u.prototype,r};function Ct(r,e,t,n){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?Ur(r,e,t,n):typeof e=="string"?Dr(r,e,t):jr(r,e)}u.from=function(r,e,t){return Ct(null,r,e,t)};u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&u[Symbol.species]);function Ft(r){if(typeof r!="number")throw new TypeError('"size" argument must be a number');if(r<0)throw new RangeError('"size" argument must not be negative')}function Mr(r,e,t,n){return Ft(e),e<=0?Y(r,e):t!==void 0?typeof n=="string"?Y(r,e).fill(t,n):Y(r,e).fill(t):Y(r,e)}u.alloc=function(r,e,t){return Mr(null,r,e,t)};function We(r,e){if(Ft(e),r=Y(r,e<0?0:Ge(e)|0),!u.TYPED_ARRAY_SUPPORT)for(var t=0;t<e;++t)r[t]=0;return r}u.allocUnsafe=function(r){return We(null,r)};u.allocUnsafeSlow=function(r){return We(null,r)};function Dr(r,e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!u.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=Nt(e,t)|0;r=Y(r,n);var i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}function ke(r,e){var t=e.length<0?0:Ge(e.length)|0;r=Y(r,t);for(var n=0;n<t;n+=1)r[n]=e[n]&255;return r}function Ur(r,e,t,n){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");return t===void 0&&n===void 0?e=new Uint8Array(e):n===void 0?e=new Uint8Array(e,t):e=new Uint8Array(e,t,n),u.TYPED_ARRAY_SUPPORT?(r=e,r.__proto__=u.prototype):r=ke(r,e),r}function jr(r,e){if($(e)){var t=Ge(e.length)|0;return r=Y(r,t),r.length===0||e.copy(r,0,0,t),r}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||nn(e.length)?Y(r,0):ke(r,e);if(e.type==="Buffer"&&Ot(e.data))return ke(r,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function Ge(r){if(r>=Ae())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ae().toString(16)+" bytes");return r|0}u.isBuffer=on;function $(r){return!!(r!=null&&r._isBuffer)}u.compare=function(e,t){if(!$(e)||!$(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,o=0,s=Math.min(n,i);o<s;++o)if(e[o]!==t[o]){n=e[o],i=t[o];break}return n<i?-1:i<n?1:0};u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};u.concat=function(e,t){if(!Ot(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return u.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=u.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!$(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i};function Nt(r,e){if($(r))return r.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(r)||r instanceof ArrayBuffer))return r.byteLength;typeof r!="string"&&(r=""+r);var t=r.length;if(t===0)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return Ie(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return kt(r).length;default:if(n)return Ie(r).length;e=(""+e).toLowerCase(),n=!0}}u.byteLength=Nt;function Kr(r,e,t){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return Gr(this,e,t);case"utf8":case"utf-8":return Dt(this,e,t);case"ascii":return Jr(this,e,t);case"latin1":case"binary":return Wr(this,e,t);case"base64":return Yr(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Hr(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}u.prototype._isBuffer=!0;function Q(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Q(this,t,t+1);return this};u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Q(this,t,t+3),Q(this,t+1,t+2);return this};u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Q(this,t,t+7),Q(this,t+1,t+6),Q(this,t+2,t+5),Q(this,t+3,t+4);return this};u.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?Dt(this,0,e):Kr.apply(this,arguments)};u.prototype.equals=function(e){if(!$(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:u.compare(this,e)===0};u.prototype.inspect=function(){var e="",t=Br;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"};u.prototype.compare=function(e,t,n,i,o){if(!$(e))throw new TypeError("Argument must be a Buffer");if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),t<0||n>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&t>=n)return 0;if(i>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,o>>>=0,this===e)return 0;for(var s=o-i,a=n-t,c=Math.min(s,a),d=this.slice(i,o),h=e.slice(t,n),l=0;l<c;++l)if(d[l]!==h[l]){s=d[l],a=h[l];break}return s<a?-1:a<s?1:0};function Bt(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=u.from(e,n)),$(e))return e.length===0?-1:at(r,e,t,n,i);if(typeof e=="number")return e=e&255,u.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):at(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function at(r,e,t,n,i){var o=1,s=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;o=2,s/=2,a/=2,t/=2}function c(f,v){return o===1?f[v]:f.readUInt16BE(v*o)}var d;if(i){var h=-1;for(d=t;d<s;d++)if(c(r,d)===c(e,h===-1?0:d-h)){if(h===-1&&(h=d),d-h+1===a)return h*o}else h!==-1&&(d-=d-h),h=-1}else for(t+a>s&&(t=s-a),d=t;d>=0;d--){for(var l=!0,p=0;p<a;p++)if(c(r,d+p)!==c(e,p)){l=!1;break}if(l)return d}return-1}u.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};u.prototype.indexOf=function(e,t,n){return Bt(this,e,t,n,!0)};u.prototype.lastIndexOf=function(e,t,n){return Bt(this,e,t,n,!1)};function kr(r,e,t,n){t=Number(t)||0;var i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(s*2,2),16);if(isNaN(a))return s;r[t+s]=a}return s}function Lr(r,e,t,n){return Ce(Ie(e,r.length-t),r,t,n)}function Mt(r,e,t,n){return Ce(tn(e),r,t,n)}function qr(r,e,t,n){return Mt(r,e,t,n)}function $r(r,e,t,n){return Ce(kt(e),r,t,n)}function zr(r,e,t,n){return Ce(rn(e,r.length-t),r,t,n)}u.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t|0,isFinite(n)?(n=n|0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-t;if((n===void 0||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return kr(this,e,t,n);case"utf8":case"utf-8":return Lr(this,e,t,n);case"ascii":return Mt(this,e,t,n);case"latin1":case"binary":return qr(this,e,t,n);case"base64":return $r(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return zr(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}};u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Yr(r,e,t){return e===0&&t===r.length?st(r):st(r.slice(e,t))}function Dt(r,e,t){t=Math.min(r.length,t);for(var n=[],i=e;i<t;){var o=r[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=t){var c,d,h,l;switch(a){case 1:o<128&&(s=o);break;case 2:c=r[i+1],(c&192)===128&&(l=(o&31)<<6|c&63,l>127&&(s=l));break;case 3:c=r[i+1],d=r[i+2],(c&192)===128&&(d&192)===128&&(l=(o&15)<<12|(c&63)<<6|d&63,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:c=r[i+1],d=r[i+2],h=r[i+3],(c&192)===128&&(d&192)===128&&(h&192)===128&&(l=(o&15)<<18|(c&63)<<12|(d&63)<<6|h&63,l>65535&&l<1114112&&(s=l))}}s===null?(s=65533,a=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),i+=a}return Vr(n)}var ct=4096;function Vr(r){var e=r.length;if(e<=ct)return String.fromCharCode.apply(String,r);for(var t="",n=0;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=ct));return t}function Jr(r,e,t){var n="";t=Math.min(r.length,t);for(var i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function Wr(r,e,t){var n="";t=Math.min(r.length,t);for(var i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function Gr(r,e,t){var n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);for(var i="",o=e;o<t;++o)i+=en(r[o]);return i}function Hr(r,e,t){for(var n=r.slice(e,t),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+n[o+1]*256);return i}u.prototype.slice=function(e,t){var n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i;if(u.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=u.prototype;else{var o=t-e;i=new u(o,void 0);for(var s=0;s<o;++s)i[s]=this[s+e]}return i};function T(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUIntLE=function(e,t,n){e=e|0,t=t|0,n||T(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i};u.prototype.readUIntBE=function(e,t,n){e=e|0,t=t|0,n||T(e,t,this.length);for(var i=this[e+--t],o=1;t>0&&(o*=256);)i+=this[e+--t]*o;return i};u.prototype.readUInt8=function(e,t){return t||T(e,1,this.length),this[e]};u.prototype.readUInt16LE=function(e,t){return t||T(e,2,this.length),this[e]|this[e+1]<<8};u.prototype.readUInt16BE=function(e,t){return t||T(e,2,this.length),this[e]<<8|this[e+1]};u.prototype.readUInt32LE=function(e,t){return t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};u.prototype.readUInt32BE=function(e,t){return t||T(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};u.prototype.readIntLE=function(e,t,n){e=e|0,t=t|0,n||T(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i};u.prototype.readIntBE=function(e,t,n){e=e|0,t=t|0,n||T(e,t,this.length);for(var i=t,o=1,s=this[e+--i];i>0&&(o*=256);)s+=this[e+--i]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*t)),s};u.prototype.readInt8=function(e,t){return t||T(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};u.prototype.readInt16LE=function(e,t){t||T(e,2,this.length);var n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};u.prototype.readInt16BE=function(e,t){t||T(e,2,this.length);var n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};u.prototype.readInt32LE=function(e,t){return t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};u.prototype.readInt32BE=function(e,t){return t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};u.prototype.readFloatLE=function(e,t){return t||T(e,4,this.length),xe(this,e,!0,23,4)};u.prototype.readFloatBE=function(e,t){return t||T(e,4,this.length),xe(this,e,!1,23,4)};u.prototype.readDoubleLE=function(e,t){return t||T(e,8,this.length),xe(this,e,!0,52,8)};u.prototype.readDoubleBE=function(e,t){return t||T(e,8,this.length),xe(this,e,!1,52,8)};function D(r,e,t,n,i,o){if(!$(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}u.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t|0,n=n|0,!i){var o=Math.pow(2,8*n)-1;D(this,e,t,n,o,0)}var s=1,a=0;for(this[t]=e&255;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n};u.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t|0,n=n|0,!i){var o=Math.pow(2,8*n)-1;D(this,e,t,n,o,0)}var s=n-1,a=1;for(this[t+s]=e&255;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n};u.prototype.writeUInt8=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e&255,t+1};function Te(r,e,t,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(r.length-t,2);i<o;++i)r[t+i]=(e&255<<8*(n?i:1-i))>>>(n?i:1-i)*8}u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Te(this,e,t,!0),t+2};u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Te(this,e,t,!1),t+2};function Oe(r,e,t,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(r.length-t,4);i<o;++i)r[t+i]=e>>>(n?i:3-i)*8&255}u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255):Oe(this,e,t,!0),t+4};u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Oe(this,e,t,!1),t+4};u.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t|0,!i){var o=Math.pow(2,8*n-1);D(this,e,t,n,o-1,-o)}var s=0,a=1,c=0;for(this[t]=e&255;++s<n&&(a*=256);)e<0&&c===0&&this[t+s-1]!==0&&(c=1),this[t+s]=(e/a>>0)-c&255;return t+n};u.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t|0,!i){var o=Math.pow(2,8*n-1);D(this,e,t,n,o-1,-o)}var s=n-1,a=1,c=0;for(this[t+s]=e&255;--s>=0&&(a*=256);)e<0&&c===0&&this[t+s+1]!==0&&(c=1),this[t+s]=(e/a>>0)-c&255;return t+n};u.prototype.writeInt8=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e&255,t+1};u.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Te(this,e,t,!0),t+2};u.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Te(this,e,t,!1),t+2};u.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Oe(this,e,t,!0),t+4};u.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t|0,n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Oe(this,e,t,!1),t+4};function Ut(r,e,t,n,i,o){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function jt(r,e,t,n,i){return i||Ut(r,e,t,4),Tt(r,e,t,n,23,4),t+4}u.prototype.writeFloatLE=function(e,t,n){return jt(this,e,t,!0,n)};u.prototype.writeFloatBE=function(e,t,n){return jt(this,e,t,!1,n)};function Kt(r,e,t,n,i){return i||Ut(r,e,t,8),Tt(r,e,t,n,52,8),t+8}u.prototype.writeDoubleLE=function(e,t,n){return Kt(this,e,t,!0,n)};u.prototype.writeDoubleBE=function(e,t,n){return Kt(this,e,t,!1,n)};u.prototype.copy=function(e,t,n,i){if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var o=i-n,s;if(this===e&&n<t&&t<i)for(s=o-1;s>=0;--s)e[s+t]=this[s+n];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o};u.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),e.length===1){var o=e.charCodeAt(0);o<256&&(e=o)}if(i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else typeof e=="number"&&(e=e&255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);var s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{var a=$(e)?e:Ie(new u(e,i).toString()),c=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%c]}return this};var Xr=/[^+\/0-9A-Za-z-_]/g;function Zr(r){if(r=Qr(r).replace(Xr,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Qr(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function en(r){return r<16?"0"+r.toString(16):r.toString(16)}function Ie(r,e){e=e||1/0;for(var t,n=r.length,i=null,o=[],s=0;s<n;++s){if(t=r.charCodeAt(s),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function tn(r){for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function rn(r,e){for(var t,n,i,o=[],s=0;s<r.length&&!((e-=2)<0);++s)t=r.charCodeAt(s),n=t>>8,i=t%256,o.push(i),o.push(n);return o}function kt(r){return Or(Zr(r))}function Ce(r,e,t,n){for(var i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function nn(r){return r!==r}function on(r){return r!=null&&(!!r._isBuffer||Lt(r)||sn(r))}function Lt(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function sn(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&Lt(r.slice(0,0))}const Be=r=>typeof r=="string"&&/^0x[0-9A-Fa-f]*$/.test(r),ut=r=>u.from(r,"utf8").toString("hex");var x,z,qt,V;function C(r){return r?typeof r=="number"?r:r.startsWith("0x")?parseInt(r,16):parseInt(r,10):1}class an extends ze{constructor({chainId:e,rpc:t,walletServer:n,appId:i}){super(),x.add(this),this.networkVersion="1",ae(e,"'chainId' is required"),this.networkVersion=`${C(e)}`,this.chainId=`0x${C(e).toString(16)}`,this.rpc=t||Qt[this.networkVersion],ae(this.rpc,"'rpc' is required"),this.injectedWalletServer=n,this._blocto={sessionKey:M.prod,walletServer:this.injectedWalletServer||"",blockchainName:"",networkType:"",supportNetworkList:{},switchableNetwork:{}},this.appId=i||Pe}send(e,t){return w(this,void 0,void 0,function*(){switch(!0){case t instanceof Function:return this.sendAsync(e,t);case(typeof e=="string"&&Array.isArray(t)):return this.sendAsync({jsonrpc:"2.0",method:e,params:t});default:return this.sendAsync(e)}})}sendAsync(e,t){return w(this,void 0,void 0,function*(){const n=new Promise(i=>{if(Array.isArray(e)){const o=e.filter(h=>h.method==="eth_sendTransaction").map(h=>{var l;return(l=h.params)===null||l===void 0?void 0:l[0]}),s=Math.floor(Math.random()*1e4),a={method:"blocto_sendBatchTransaction",params:o},c=this.request(a),d=e.map(({method:h,params:l},p)=>h==="eth_sendTransaction"?c:this.request({id:s+p+1,jsonrpc:"2.0",method:h,params:l}));Promise.allSettled(d).then(h=>i(h.map((l,p)=>({id:String(s+p+1),jsonrpc:"2.0",method:e[p].method,result:l.status==="fulfilled"?l.value:void 0,error:l.status!=="fulfilled"?l.reason:void 0})))).catch(h=>{throw E.ethErrors.rpc.internal(h==null?void 0:h.message)})}else this.request(Object.assign(Object.assign({},e),{id:Number(e.id)})).then(i)});if(t)n.then(i=>t(null,i)).catch(i=>t(i));else return n})}sendUserOperation(e){return w(this,void 0,void 0,function*(){return this.request({method:"eth_sendUserOperation",params:[e]})})}request(e){var t,n,i,o,s,a,c,d,h,l;return w(this,void 0,void 0,function*(){if(!(e!=null&&e.method))throw E.ethErrors.rpc.invalidRequest();const p=window.ethereum;if(p&&p.isBlocto){if(e.method==="wallet_switchEthereumChain"){if(!(!((n=(t=e==null?void 0:e.params)===null||t===void 0?void 0:t[0])===null||n===void 0)&&n.chainId))throw E.ethErrors.rpc.invalidParams();return p.request(e).then(()=>{var m,y,S;return this.networkVersion=`${C((m=e==null?void 0:e.params)===null||m===void 0?void 0:m[0].chainId)}`,this.chainId=`0x${C((y=e==null?void 0:e.params)===null||y===void 0?void 0:y[0].chainId).toString(16)}`,this.rpc=(S=v==null?void 0:v[this.networkVersion])===null||S===void 0?void 0:S.rpc_url,null})}return p.request(e)}const{blockchainName:f,switchableNetwork:v,sessionKey:g}=yield N(this,x,"m",z).call(this);switch(e.method){case"eth_chainId":return this.chainId;case"net_version":return this.networkVersion;case"wallet_addEthereumChain":return this.loadSwitchableNetwork((e==null?void 0:e.params)||[]);case"eth_call":{const m=yield this.handleReadRequests(e);if(!m||m&&!m.result&&m.error){const y=!((i=m==null?void 0:m.error)===null||i===void 0)&&i.message?m.error.message:"Request failed";throw E.ethErrors.rpc.internal(y)}return m.result}case"wallet_switchEthereumChain":{if(!(!((s=(o=e==null?void 0:e.params)===null||o===void 0?void 0:o[0])===null||s===void 0)&&s.chainId))throw E.ethErrors.rpc.invalidParams();const m=e.params[0].chainId;if(!R(g,f)){const y=C(m);if(!v[y])throw E.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${m}". Try adding the chain using wallet_addEthereumChain first.`});return this.networkVersion=`${y}`,this.chainId=`0x${y.toString(16)}`,this.rpc=v[y].rpc_url,this.eventListeners.chainChanged.forEach(S=>S(this.chainId)),null}break}}if(!R(g,f)){const m=(a=e==null?void 0:e.params)===null||a===void 0?void 0:a[0];e.method==="eth_requestAccounts"&&rt(m)?yield this.enable(m):yield this.enable()}try{let m=null,y=null;switch(e.method){case"eth_requestAccounts":yield this.fetchAccounts();case"eth_accounts":y=R(g,f);break;case"eth_coinbase":{y=(c=R(g,f))===null||c===void 0?void 0:c[0];break}case"eth_signTypedData_v3":case"eth_signTypedData":case"eth_signTypedData_v4":case"personal_sign":case"eth_sign":{y=yield this.handleSign(e);break}case"wallet_disconnect":{this.handleDisconnect(),y=null;break}case"eth_sendTransaction":y=yield this.handleSendTransaction(e);break;case"blocto_sendBatchTransaction":y=yield this.handleSendBatchTransaction(e);break;case"eth_signTransaction":case"eth_sendRawTransaction":throw E.ethErrors.rpc.methodNotSupported("Method Not Supported: "+e.method);case"eth_sendUserOperation":y=yield this.handleSendUserOperation(e);break;case"wallet_switchEthereumChain":{if(!(!((h=(d=e==null?void 0:e.params)===null||d===void 0?void 0:d[0])===null||h===void 0)&&h.chainId))throw E.ethErrors.rpc.invalidParams();const S=(l=R(g,f))===null||l===void 0?void 0:l[0],I=this.chainId,_=e.params[0].chainId;if(!v[C(_)])throw E.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${C(e.params[0].chainId)}". Try adding the chain using wallet_addEthereumChain first.`});this.networkVersion=`${C(_)}`,this.chainId=`0x${C(_).toString(16)}`,this.rpc=v[this.networkVersion].rpc_url,yield this.enable().then(([A])=>{var P;A!==S&&((P=this.eventListeners)===null||P===void 0||P.accountsChanged.forEach(O=>O([A]))),this.eventListeners.chainChanged.forEach(O=>O(this.chainId)),y=null}).catch(A=>{throw this.networkVersion=`${C(I)}`,this.chainId=`0x${C(I).toString(16)}`,this.rpc=v[this.networkVersion].rpc_url,A});break}case"eth_estimateUserOperationGas":case"eth_getUserOperationByHash":case"eth_getUserOperationReceipt":case"eth_supportedEntryPoints":y=yield this.handleBundler(e);break;default:m=yield this.handleReadRequests(e)}if(m&&!m.result&&m.error){const S=m.error.message?m.error.message:"Request failed";throw E.ethErrors.rpc.internal(S)}return m?m.result:y}catch(m){throw E.ethErrors.rpc.internal(m==null?void 0:m.message)}})}bloctoApi(e,t){var n;return w(this,void 0,void 0,function*(){const{walletServer:i,blockchainName:o,sessionKey:s}=yield N(this,x,"m",z).call(this),a=((n=q(s))===null||n===void 0?void 0:n.code)||"";if(!a)throw E.ethErrors.provider.unauthorized();return fetch(`${i}/api/${o}${e}`,Object.assign({headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":a}},t)).then(c=>re(c,s,()=>{var d;(d=this.eventListeners)===null||d===void 0||d.disconnect.forEach(h=>h(E.ethErrors.provider.disconnected()))})).catch(c=>{throw(c==null?void 0:c.error_code)==="unsupported_method"?E.ethErrors.rpc.methodNotSupported("Method Not Supported: "+c.message):E.ethErrors.rpc.server({code:-32005,message:`Blocto server error: ${c.message}`})})})}responseListener(e,t){return w(this,void 0,void 0,function*(){const{walletServer:n}=yield N(this,x,"m",z).call(this);return new Promise((i,o)=>te("message",(s,a)=>{const c=s;c.origin===n&&c.data.type==="ETH:FRAME:RESPONSE"&&(c.data.status==="APPROVED"&&(a(),B(e),i(c.data[t])),c.data.status==="DECLINED"&&(a(),B(e),c.data.errorCode==="incorrect_session_id"&&this.handleDisconnect(),o(E.ethErrors.provider.userRejectedRequest(c.data.errorMessage)))),c.data.type==="ETH:FRAME:CLOSE"&&(a(),B(e),o(E.ethErrors.provider.userRejectedRequest("User declined the request")))}))})}setIframe(e){return w(this,void 0,void 0,function*(){if(typeof window>"u")throw E.ethErrors.provider.custom({code:1001,message:"Blocto SDK only works in browser environment"});const{walletServer:t,blockchainName:n}=yield N(this,x,"m",z).call(this),i=ie(`${t}/${this.appId}/${n}${e}`);return oe(i),i})}enable(e){return w(this,void 0,void 0,function*(){const{walletServer:t,blockchainName:n,sessionKey:i}=yield N(this,x,"m",z).call(this),o=window.ethereum;if(o&&o.isBlocto)return o.chainId!==this.chainId&&(yield o.request({method:"wallet_addEthereumChain",params:[{chainId:this.chainId}]}),yield o.request({method:"wallet_switchEthereumChain",params:[{chainId:this.chainId}]}),he(i,n,[o.address])),new Promise((h,l)=>setTimeout(()=>o.enable().then(h).catch(l),10));const s=R(i,n);if(s)return new Promise(h=>{h(s)});const a=new URLSearchParams;a.set("l6n",window.location.origin),a.set("v",ve);const c=e&&rt(e)?`/${e}`:"",d=yield this.setIframe(`/authn${c}?${a.toString()}`);return new Promise((h,l)=>{te("message",(p,f)=>{var v;const g=p;g.origin===t&&(g.data.type==="ETH:FRAME:RESPONSE"&&(f(),B(d),(v=this.eventListeners)===null||v===void 0||v.connect.forEach(m=>m({chainId:this.chainId})),pe(i,{code:g.data.code,connected:!0,accounts:{[n]:[g.data.addr]}},g.data.exp),h([g.data.addr])),g.data.type==="ETH:FRAME:CLOSE"&&(f(),B(d),l(E.ethErrors.provider.userRejectedRequest())))})})})}fetchAccounts(){return w(this,void 0,void 0,function*(){N(this,x,"m",V).call(this);const{blockchainName:e,sessionKey:t}=yield N(this,x,"m",z).call(this),{accounts:n}=yield this.bloctoApi("/accounts");return he(t,e,n),n})}handleReadRequests(e){return w(this,void 0,void 0,function*(){return N(this,x,"m",V).call(this),fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))}).then(t=>t.json()).catch(t=>{throw E.ethErrors.rpc.internal(t)})})}handleSign({method:e,params:t}){return w(this,void 0,void 0,function*(){let n="";if(Array.isArray(t)){if(e==="eth_sign")n=Be(t[1])?t[1].slice(2):ut(t[1]);else if(e==="personal_sign")n=Be(t[0])?t[0].slice(2):ut(t[0]);else if(["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4"].includes(e)){n=t[1];const{domain:s}=JSON.parse(n);if(Be(s.chainId))throw E.ethErrors.rpc.invalidParams(`Provided chainId "${s.chainId}" must be a number`);if(C(s.chainId)!==C(this.chainId))throw E.ethErrors.rpc.invalidParams(`Provided chainId "${s.chainId}" must match the active chainId "${C(this.chainId)}"`)}}N(this,x,"m",V).call(this);const{signatureId:i}=yield this.bloctoApi("/user-signature",{method:"POST",body:JSON.stringify({method:e,message:n})}),o=yield this.setIframe(`/user-signature/${i}`);return this.responseListener(o,"signature")})}handleSendTransaction(e){var t;return w(this,void 0,void 0,function*(){if(N(this,x,"m",V).call(this),!vt((t=e.params)===null||t===void 0?void 0:t[0]))throw E.ethErrors.rpc.invalidParams();const{authorizationId:n}=yield this.bloctoApi("/authz",{method:"POST",body:JSON.stringify(e.params)}),i=yield this.setIframe(`/authz/${n}`);return this.responseListener(i,"txHash")})}handleSendBatchTransaction(e){return w(this,void 0,void 0,function*(){N(this,x,"m",V).call(this);const n=(o=>o.map(s=>"params"in s?s.params[0]:s))(e.params),i=Object.assign(Object.assign({},e),{params:n});if(!ur(i.params))throw E.ethErrors.rpc.invalidParams();return this.handleSendTransaction(i)})}handleSendUserOperation(e){return w(this,void 0,void 0,function*(){N(this,x,"m",V).call(this);const{authorizationId:t}=yield this.bloctoApi("/user-operation",{method:"POST",body:JSON.stringify(e.params)}),n=yield this.setIframe(`/user-operation/${t}`);return this.responseListener(n,"userOpHash")})}handleBundler(e){return w(this,void 0,void 0,function*(){return N(this,x,"m",V).call(this),this.bloctoApi("/rpc/bundler",{method:"POST",body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))})})}handleDisconnect(){var e;return w(this,void 0,void 0,function*(){const t=window.ethereum;if(t&&t.isBlocto)return t.disconnect();const{sessionKey:n,blockchainName:i}=yield N(this,x,"m",z).call(this);$e(n,i),(e=this.eventListeners)===null||e===void 0||e.disconnect.forEach(o=>o(E.ethErrors.provider.disconnected()))})}loadSwitchableNetwork(e){return w(this,void 0,void 0,function*(){if(e!=null&&e.length){const t=e.map(({chainId:n,rpcUrls:i})=>{if(!n)throw E.ethErrors.rpc.invalidParams("Empty chainId");if(!(i!=null&&i.length))throw E.ethErrors.rpc.invalidParams("Empty rpcUrls");return N(this,x,"m",qt).call(this,{chainId:`${C(n)}`,rpcUrls:i})});return Promise.all(t).then(()=>null)}else throw E.ethErrors.rpc.invalidParams("Empty networkList")})}}x=new WeakSet,z=function(){return w(this,void 0,void 0,function*(){Object.keys(this._blocto.supportNetworkList).length||(yield hr().then(s=>this._blocto.supportNetworkList=s).catch(s=>{throw E.ethErrors.provider.custom({code:1001,message:`Get blocto server failed: ${s.message}`})}));const{chain_id:e,name:t,network_type:n,blocto_service_environment:i,display_name:o}=this._blocto.supportNetworkList[this.networkVersion];if(!e)throw E.ethErrors.provider.unsupportedMethod(`Get support chain failed: ${this.networkVersion} might not be supported yet.`);return this._blocto=Object.assign(Object.assign({},this._blocto),{sessionKey:er[i],walletServer:this.injectedWalletServer||et[i],blockchainName:t,networkType:n,switchableNetwork:Object.assign(Object.assign({},this._blocto.switchableNetwork),{[e]:{name:t,display_name:o,network_type:n,wallet_web_url:this._blocto.walletServer,rpc_url:this.rpc}})}),this._blocto})},qt=function({chainId:e,rpcUrls:t}){return w(this,void 0,void 0,function*(){const{supportNetworkList:n}=yield N(this,x,"m",z).call(this),{chain_id:i,name:o,display_name:s,network_type:a,blocto_service_environment:c}=n[e],d=et[c];this._blocto.switchableNetwork[i]={name:o,display_name:s,network_type:a,wallet_web_url:d,rpc_url:t[0]}})},V=function(){const e=window.ethereum;if(e&&e.isBlocto&&C(e.chainId)!==C(this.chainId))throw E.ethErrors.provider.chainDisconnected()};function cn(r){if(r.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var n=0;n<r.length;n++){var i=r.charAt(n),o=i.charCodeAt(0);if(e[o]!==255)throw new TypeError(i+" is ambiguous");e[o]=n}var s=r.length,a=r.charAt(0),c=Math.log(s)/Math.log(256),d=Math.log(256)/Math.log(s);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var v=0,g=0,m=0,y=f.length;m!==y&&f[m]===0;)m++,v++;for(var S=(y-m)*d+1>>>0,I=new Uint8Array(S);m!==y;){for(var _=f[m],A=0,P=S-1;(_!==0||A<g)&&P!==-1;P--,A++)_+=256*I[P]>>>0,I[P]=_%s>>>0,_=_/s>>>0;if(_!==0)throw new Error("Non-zero carry");g=A,m++}for(var O=S-g;O!==S&&I[O]===0;)O++;for(var me=a.repeat(v);O<S;++O)me+=r.charAt(I[O]);return me}function l(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;for(var v=0,g=0,m=0;f[v]===a;)g++,v++;for(var y=(f.length-v)*c+1>>>0,S=new Uint8Array(y);f[v];){var I=e[f.charCodeAt(v)];if(I===255)return;for(var _=0,A=y-1;(I!==0||_<m)&&A!==-1;A--,_++)I+=s*S[A]>>>0,S[A]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");m=_,v++}for(var P=y-m;P!==y&&S[P]===0;)P++;for(var O=new Uint8Array(g+(y-P)),me=g;P!==y;)O[me++]=S[P++];return O}function p(f){var v=l(f);if(v)return v;throw new Error("Non-base"+s+" character")}return{encode:h,decodeUnsafe:l,decode:p}}var un=cn;const hn=un,dn="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var ln=hn(dn),ht=dr(ln);let G;try{G=require("@solana/web3.js")}catch{}class fn extends ze{constructor({net:e="mainnet-beta",server:t,appId:n,rpc:i}){if(super(),ae(e,"'net' is required"),ae(Object.values(ee).includes(e),"unsupported net"),this.net=e,this.rpc=i||(e==="mainnet-beta"?"https://free.rpcpool.com":`https://api.${e}.solana.com`),this.server=t||tr[this.net]||"",this.appId=n||Pe,this.sessionKey=rr[this.net],!G)throw new Error("No @solana/web3.js installed. Please install it to interact with Solana.")}request(e){var t;return w(this,void 0,void 0,function*(){const n=window.solana;if(n&&n.isBlocto)return n.request(e);R(this.sessionKey,b.SOLANA)||(yield this.connect());try{let i=null,o=null;switch(e.method){case"connect":o=yield this.fetchAccounts();break;case"disconnect":this.disconnect();break;case"getAccounts":o=!((t=R(this.sessionKey,b.SOLANA))===null||t===void 0)&&t.length?R(this.sessionKey,b.SOLANA):yield this.fetchAccounts();break;case"getAccountInfo":{const s=yield this.handleReadRequests(e),[a,c]=s.result.value.data;o=Object.assign(Object.assign({},s.result.value),{data:u.from(a,c),owner:new G.PublicKey(s.result.value.owner)});break}case"convertToProgramWalletTransaction":o=yield this.handleConvertTransaction(e);break;case"signAndSendTransaction":o=yield this.handleSignAndSendTransaction(e);break;case"signTransaction":case"signAllTransactions":throw new Error(`Blocto is program wallet, which doesn't support ${e.method}. Use signAndSendTransaction instead.`);default:i=yield this.handleReadRequests(e)}if(i&&!i.result&&i.error){const s=i.error.message?i.error.message:"Request failed";throw new Error(s)}return i?i.result:o}catch(i){throw console.error(i),i}})}connect(){return w(this,void 0,void 0,function*(){const e=window.solana;return e&&e.isBlocto?new Promise(t=>{e.on("connect",()=>{he(this.sessionKey,b.SOLANA,[e.publicKey.toBase58()]),t()}),e.connect()}):new Promise((t,n)=>{if(typeof window>"u")return n("Currently only supported in browser");if(R(this.sessionKey,b.SOLANA))return t();const i=encodeURIComponent(window.location.origin),o=ie(`${this.server}/${this.appId}/solana/authn?l6n=${i}&v=${ve}`);oe(o),te("message",(s,a)=>{const c=s;c.origin===this.server&&(c.data.type==="SOL:FRAME:RESPONSE"&&(a(),B(o),this.eventListeners.connect.forEach(d=>d(this.net)),pe(this.sessionKey,{code:c.data.code,connected:!0,accounts:{[b.SOLANA]:[c.data.addr]}},c.data.exp),t()),c.data.type==="SOL:FRAME:CLOSE"&&(a(),B(o),n(new Error("User declined the login request"))))})})})}disconnect(){return w(this,void 0,void 0,function*(){const e=window.solana;if(e&&e.isBlocto){yield e.disconnect();return}this.eventListeners.disconnect.forEach(t=>t(null)),$e(this.sessionKey,b.SOLANA)})}fetchAccounts(){var e;return w(this,void 0,void 0,function*(){const t=((e=q(this.sessionKey))===null||e===void 0?void 0:e.code)||"",{accounts:n}=yield fetch(`${this.server}/api/solana/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":t}}).then(i=>re(i,this.sessionKey));return he(this.sessionKey,b.SOLANA,n),n})}handleReadRequests(e){return w(this,void 0,void 0,function*(){return fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))}).then(t=>t.json())})}convertToProgramWalletTransaction(e){return w(this,void 0,void 0,function*(){const t=window.solana;if(t&&t.isBlocto)return t.convertToProgramWalletTransaction(e);const n=yield this.request({method:"convertToProgramWalletTransaction",params:{message:e.serializeMessage().toString("hex")}});return this.toTransaction(n,[])})}signAndSendTransaction(e,t){return w(this,void 0,void 0,function*(){const n=window.solana;if(n&&n.isBlocto)return n.signAndSendTransaction(e);const i={};if(t){t.commitment&&(i.commitment=t.commitment);const o=t?t._rpcEndpoint:null;o&&o!==this.rpc&&(this.rpc=o,this.disconnect(),yield this.connect())}return this.request({method:"signAndSendTransaction",params:Object.assign({signatures:yield this.collectSignatures(e),message:e.serializeMessage().toString("hex")},i)})})}toTransaction(e,t){return w(this,void 0,void 0,function*(){const n=G.Message.from(u.from(e,"hex")),i=new G.Transaction;return i.recentBlockhash=n.recentBlockhash,n.header.numRequiredSignatures>0&&(i.feePayer=n.accountKeys[0]),t.forEach((o,s)=>{const a={signature:o===G.PublicKey.default.toBase58()?null:ht.decode(o),publicKey:n.accountKeys[s]};i.signatures.push(a)}),n.instructions.forEach(o=>{const s=o.accounts.map(a=>({pubkey:n.accountKeys[a],isSigner:a<n.header.numRequiredSignatures,isWritable:n.isAccountWritable(a)}));i.instructions.push(new G.TransactionInstruction({keys:s,programId:n.accountKeys[o.programIdIndex],data:ht.decode(o.data)}))}),i})}collectSignatures(e){return w(this,void 0,void 0,function*(){return e.signatures.reduce((t,n)=>(n.signature&&(t[n.publicKey.toBase58()]=n.signature.toString("hex")),t),{})})}handleConvertTransaction(e){var t;return w(this,void 0,void 0,function*(){const n=((t=q(this.sessionKey))===null||t===void 0?void 0:t.code)||"";return fetch(`${this.server}/api/solana/convertToWalletTx`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":n},body:JSON.stringify(e.params)}).then(i=>re(i,this.sessionKey))})}handleSignAndSendTransaction(e){var t;return w(this,void 0,void 0,function*(){const n=((t=q(this.sessionKey))===null||t===void 0?void 0:t.code)||"",{authorizationId:i}=yield fetch(`${this.server}/api/solana/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":n},body:JSON.stringify(e.params)}).then(s=>re(s,this.sessionKey));if(typeof window>"u")throw new Error("Currently only supported in browser");const o=ie(`${this.server}/${this.appId}/solana/authz/${i}`);return oe(o),new Promise((s,a)=>te("message",(c,d)=>{const h=c;h.origin===this.server&&h.data.type==="SOL:FRAME:RESPONSE"&&(h.data.status==="APPROVED"&&(d(),B(o),s(h.data.txHash)),h.data.status==="DECLINED"&&(d(),B(o),h.data.errorCode==="incorrect_session_id"&&this.disconnect(),a(new Error(h.data.errorMessage))))}))})}}const pn=r=>{var e,t;const n=Object.assign({},r),{message:i,nonce:o,address:s,application:a,chainId:c}=r;return typeof i!="string"&&(n.message=(e=String(i))!==null&&e!==void 0?e:""),typeof o!="string"&&(n.nonce=(t=String(o))!==null&&t!==void 0?t:""),s&&typeof s!="boolean"&&(n.address=!!s),a&&typeof a!="boolean"&&(n.application=!!a),c&&typeof c!="boolean"&&(n.chainId=!!c),n};class vn extends ze{constructor({chainId:e,server:t,appId:n}){super(),this.publicKey=[],this.authKey="",ae(e,"'chainId' is required"),ae(n,"It is necessary to interact with Blocto wallet via your app id. Please visit https://developers.blocto.app for more details."),this.chainId=e,this.networkName=or[e],this.api=sr[e],this.sessionKey=nr[e];const i=ir[e];this.appId=n||Pe,this.server=t||i||""}get publicAccount(){var e;return{address:((e=R(this.sessionKey,b.APTOS))===null||e===void 0?void 0:e[0])||null,publicKey:this.publicKey.length?this.publicKey:null,authKey:null,minKeysRequired:2}}network(){return w(this,void 0,void 0,function*(){return{name:this.networkName,api:this.api,chainId:this.chainId.toString()}})}isConnected(){var e;return w(this,void 0,void 0,function*(){return!!(!((e=q(this.sessionKey))===null||e===void 0)&&e.code)})}signTransaction(e){var t;return w(this,void 0,void 0,function*(){const n=window.bloctoAptos;if(n)return n.signTransaction(e);throw(yield this.isConnected())||(yield this.connect()),!((t=R(this.sessionKey,b.APTOS))===null||t===void 0)&&t.length?new Error("signTransaction method not supported."):new Error("Fail to get account")})}disconnect(){return w(this,void 0,void 0,function*(){const e=window.bloctoAptos;if(e){yield e.disconnect();return}$e(this.sessionKey,b.APTOS)})}signAndSubmitTransaction(e,t={}){var n,i;return w(this,void 0,void 0,function*(){const o=window.bloctoAptos;if(o)return o.signAndSubmitTransaction(e,t);if((yield this.isConnected())||(yield this.connect()),!(!((n=R(this.sessionKey,b.APTOS))===null||n===void 0)&&n.length))throw new Error("Fail to get account");const a=((i=q(this.sessionKey))===null||i===void 0?void 0:i.code)||"",{authorizationId:c}=yield fetch(`${this.server}/api/aptos/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":a},body:JSON.stringify(Object.assign(Object.assign({},e),t))}).then(h=>re(h,this.sessionKey));if(typeof window>"u")throw new Error("Currently only supported in browser");const d=ie(`${this.server}/${this.appId}/aptos/authz/${c}`);return oe(d),new Promise((h,l)=>te("message",(p,f)=>{const v=p;v.origin===this.server&&v.data.type==="APTOS:FRAME:RESPONSE"&&(v.data.status==="APPROVED"&&(f(),B(d),h({hash:v.data.txHash})),v.data.status==="DECLINED"&&(f(),B(d),v.data.errorCode==="incorrect_session_id"&&this.disconnect(),l(new Error(v.data.errorMessage))))}))})}signMessage(e){var t,n;return w(this,void 0,void 0,function*(){const i=window.bloctoAptos,o=pn(e);if(i)return i.signMessage(o);if((yield this.isConnected())||(yield this.connect()),!(!((t=R(this.sessionKey,b.APTOS))===null||t===void 0)&&t.length))throw new Error("Fail to get account");if(typeof window>"u")throw new Error("Currently only supported in browser");const a=((n=q(this.sessionKey))===null||n===void 0?void 0:n.code)||"",{signatureId:c}=yield fetch(`${this.server}/api/aptos/user-signature`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":a},body:JSON.stringify(o)}).then(l=>re(l,this.sessionKey)),d=`${this.server}/${this.appId}/aptos/user-signature/${c}`,h=ie(d);return oe(h),new Promise((l,p)=>te("message",(f,v)=>{const g=f;g.origin===this.server&&g.data.type==="APTOS:FRAME:RESPONSE"&&(g.data.status==="APPROVED"&&(v(),B(h),l(g.data)),g.data.status==="DECLINED"&&(v(),B(h),g.data.errorCode==="incorrect_session_id"&&this.disconnect(),p(new Error(g.data.errorMessage))))}))})}connect(){return w(this,void 0,void 0,function*(){const e=window.bloctoAptos;return e?new Promise((t,n)=>setTimeout(()=>e.connect().then(t).catch(n),10)):new Promise((t,n)=>{var i,o;if(typeof window>"u")return n("Currently only supported in browser");if(!((i=R(this.sessionKey,b.APTOS))===null||i===void 0)&&i.length)return t({address:((o=R(this.sessionKey,b.APTOS))===null||o===void 0?void 0:o[0])||null,publicKey:this.publicKey,authKey:null,minKeysRequired:2});const s=encodeURIComponent(window.location.origin),a=ie(`${this.server}/${this.appId}/aptos/authn?l6n=${s}&v=${ve}}`);oe(a),te("message",(c,d)=>w(this,void 0,void 0,function*(){var h,l,p;const f=c;if(f.origin===this.server){if(f.data.type==="APTOS:FRAME:RESPONSE")if(d(),B(a),pe(this.sessionKey,{code:f.data.code,connected:!0,accounts:{[b.APTOS]:[f.data.addr]}},f.data.exp),!((h=R(this.sessionKey,b.APTOS))===null||h===void 0)&&h.length)try{const{public_keys:v}=yield fetch(`${this.server}/blocto/aptos/accounts/${(l=R(this.sessionKey,b.APTOS))===null||l===void 0?void 0:l[0]}`).then(g=>g.json());this.publicKey=v||[],t({address:((p=R(this.sessionKey,b.APTOS))===null||p===void 0?void 0:p[0])||"",publicKey:this.publicKey,authKey:null,minKeysRequired:2})}catch{return n(f)}else return n();f.data.type==="APTOS:FRAME:CLOSE"&&(d(),B(a),n(new Error("User declined the login request")))}}))})})}fetchAddress(){var e;return w(this,void 0,void 0,function*(){const t=((e=q(this.sessionKey))===null||e===void 0?void 0:e.code)||"",{accounts:n}=yield fetch(`${this.server}/api/aptos/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":t}}).then(i=>re(i,this.sessionKey));return he(this.sessionKey,b.APTOS,n),(n==null?void 0:n[0])||""})}}class mn{constructor({appId:e,ethereum:t,solana:n,aptos:i}){t&&(this.ethereum=new an(Object.assign(Object.assign({},t),{appId:e}))),n&&(this.solana=new fn(Object.assign(Object.assign({},n),{appId:e}))),i&&(this.aptos=new vn(Object.assign(Object.assign({},i),{appId:e})))}}var H=new WeakMap,ye=new WeakMap,Ee=new WeakMap,_e=new WeakMap,Me=new WeakSet,De=new WeakSet;class _n extends Wt{constructor(e){let{chains:t,options:n={}}=e;super({chains:t,options:n}),Xe(this,De),Xe(this,Me),Fe(this,"id",$t.blocto),Fe(this,"name","Blocto"),Fe(this,"ready",!0),we(this,H,{writable:!0,value:void 0}),we(this,ye,{writable:!0,value:void 0}),we(this,Ee,{writable:!0,value:void 0}),we(this,_e,{writable:!0,value:void 0}),ue(this,ye,this.onAccountsChanged.bind(this)),ue(this,Ee,this.onChainChanged.bind(this)),ue(this,_e,this.onDisconnect.bind(this))}async connect(e){try{const t=await this.getProvider(e);this.setupListeners(),this.emit("message",{type:"connecting"});const n=await t.request({method:"eth_requestAccounts"}),i=zt(n[0]),o=await this.getChainId(),s=this.isChainUnsupported(o);return{account:i,chain:{id:o,unsupported:s},provider:t}}catch(t){throw ge(this,De,lt).call(this),ge(this,Me,dt).call(this,t)?new Ze(t):t}}async disconnect(){await(await this.getProvider()).request({method:"wallet_disconnect"}),this.removeListeners(),ge(this,De,lt).call(this)}async getAccount(){const t=await(await this.getProvider()).request({method:"eth_accounts"}),[n]=t||[];if(!n)throw new Error("No accounts found");return n}async getChainId(){const t=await(await this.getProvider()).request({method:"eth_chainId"});return Qe(t)}getProvider(){var t,n,i,o,s;let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!k(this,H)){const a=(i=(n=e!=null?e:this.options.chainId)!=null?n:(t=this.chains[0])==null?void 0:t.chainId)!=null?i:1,c=(o=this.chains.find(d=>d.chainId===a))==null?void 0:o.rpc[0];ue(this,H,(s=new mn({ethereum:{chainId:a,rpc:c},appId:this.options.appId}))==null?void 0:s.ethereum)}if(!k(this,H))throw new Gt;return Promise.resolve(k(this,H))}async getSigner(){let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const[t,n]=await Promise.all([this.getProvider(),this.getAccount()]);return new Yt(t,e).getSigner(n)}async isAuthorized(){var e,t;return!!((t=(e=k(this,H))==null?void 0:e._blocto)!=null&&t.sessionKey)}async switchChain(e){const t=await this.getProvider(),n=Vt(e),i=this.chains.find(s=>s.chainId===e);if(!i)throw new Ne(new Error("chain not found on connector."));if(!t._blocto.supportNetworkList[`${e}`])throw new Ne(new Error(`Blocto unsupported chain: ${n}`));try{return await t.request({method:"wallet_addEthereumChain",params:[{chainId:n,rpcUrls:Jt(i)}]}),await t.request({method:"wallet_switchEthereumChain",params:[{chainId:n}]}),i}catch(s){throw ge(this,Me,dt).call(this,s)?new Ze(s):new Ne(s)}}onAccountsChanged(){}async onChainChanged(e){const t=Qe(e),n=this.isChainUnsupported(t),i=await this.getAccount();this.emit("change",{chain:{id:t,unsupported:n},account:i})}onDisconnect(){this.emit("disconnect")}async setupListeners(){const e=await this.getProvider();e.on("accountsChanged",k(this,ye)),e.on("chainChanged",k(this,Ee)),e.on("disconnect",k(this,_e))}async removeListeners(){const e=await this.getProvider();e.off("accountsChanged",k(this,ye)),e.off("chainChanged",k(this,Ee)),e.off("disconnect",k(this,_e))}}function dt(r){return/(user rejected)/i.test(r.message)}function lt(){ue(this,H,void 0)}export{_n as BloctoConnector};
